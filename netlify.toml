[build]
  # Base directory for the build
  base = "web"

  # Build command - prebuild script will copy updates automatically
  command = "npm run build"

  # Publish directory - relative to base directory
  # The plugin needs this to be set correctly
  publish = ".next"

  # Check for changes in both web/ and updates/ directories
  # Exit code 0 = skip build, Exit code 1 = run build
  # This ensures builds run when daily updates change, even if web/ hasn't changed
  # Note: ignore command runs from repo root, so paths are relative to root
  ignore = "git diff --quiet $CACHED_COMMIT_REF $COMMIT_REF -- web/ updates/ && exit 0 || exit 1"

[build.environment]
  # Node.js version (Next.js requires >= 18.17.0)
  NODE_VERSION = "20.11.0"

# Use Netlify's Next.js runtime
# Using explicit path for publish to avoid validation error
[[plugins]]
  package = "@netlify/plugin-nextjs"

# Scheduled Functions
# Note: Scheduled functions are configured in Netlify UI under Functions > Scheduled functions
# This section documents the configuration for reference
#
# Function: scheduled-daily-update
# Schedule: 0 9 * * * (9:00 AM daily, cron syntax)
# Timezone: America/Los_Angeles (PT)
#
# Required Environment Variables:
# - ANTHROPIC_API_KEY
# - GITHUB_TOKEN (for committing updates)
# - NOTIFICATION_EMAIL (optional, for error alerts)
